<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Database - Copernicusmarine Data Store Automated Data testing script</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Database";
        var mkdocs_page_input_path = "database_schema.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Copernicusmarine Data Store Automated Data testing script
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Database</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#to-connect">To connect:</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#list-tables">List tables:</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#tables-columns">Tables columns:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#consulting-tables">Consulting tables</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#simple-consultation">Simple consultation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#consultation-of-complex-schema">Consultation of complex schema</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../further_development/">Further</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Copernicusmarine Data Store Automated Data testing script</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Database</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="database-schema-and-usage">Database Schema and Usage</h1>
<p>Currently, the database contains two schema: </p>
<ul>
<li>
<p>A simple one with a single table with rows describing each download attempt, including errors. This one is rigid and can only contain three errors.</p>
</li>
<li>
<p>A more complex one with three tables: One containing the main information to reproduce a serie of tests ( OS used, version of the toolbox, version of the script, dates of execution), one containing all the datasets that have been tested, the service, version and variables that have been tested and if they were downloadable during the runs and one containing the errors associated with the datasets. The tables are linked between them via uuid (https://developer.mozilla.org/en-US/docs/Glossary/UUID). The collection of tests has a uuid, which is used as a foreign key in the datasets table to connect it with the first table, and each row of the dataset table has another uuid, which are used as foreign keys in the error table.</p>
</li>
</ul>
<h2 id="to-connect">To connect:</h2>
<p>Both the schema are on the same database. You will need information given in the readme of the database present in the project "project-test-datasets-subsetting-toolbox". The following command will ask a password that will also be given in the readme of the database.</p>
<pre><code class="language-bash">psql -h HOST -p PORT -U USERNAME -d DATABASE_NAME
</code></pre>
<h2 id="list-tables">List tables:</h2>
<p>There should be four tables:
- <strong>"List_of_datasets"</strong> ( the '"' are necessary to access this table). This is the table of the simple schema.
- <strong>testing_metadata</strong> containing the information about the test conditions.
- <strong>datasets_tested</strong> containing the informations about the datasets tested.
- <strong>errors</strong> containg the different errors.</p>
<h3 id="tables-columns">Tables columns:</h3>
<p><strong>List_of_datasets</strong>:
-id: UUID associated with each dataset (<strong>uuid</strong>)
-dataset_id: Dataset identifier as can be used in the copernicusmarine toolbox (<strong>String</strong>)
-dataset_version: Version of the dataset (<strong>String</strong>)
-version_part: Part of the version tested (<strong>String</strong>)
-service_name: Name of the service tested (<strong>String</strong>)
-variable_name: Variable tested (<strong>String</strong>)
-has_time_coordinate: Presence of time coordinate for the variable (<strong>Boolean</strong>)
-last_available_time: Last available time for which there is data from the describe command (<strong>String</strong>)
-region: Region of the dataset (<strong>String</strong>)
-downloadable: If the dataset was downloadable (<strong>Boolean</strong>)
-last_downloadable_time: Last available time for which there is from the subset command (<strong>String</strong>)
-first_command: Command launched for the first try (<strong>String</strong>)
-first_error: (Optional) Error if the first try did not work (<strong>String</strong>)
-second_command: (Optional) Command launched for the second try (<strong>String</strong>)
-second_error: (Optional) Error if the second try did not work (<strong>String</strong>)
-third_command: (Optional) Command launched for the third try (<strong>String</strong>)
-third_error: (Optional) Error if the third try did not work (<strong>String</strong>)</p>
<p><strong>testing_metadata</strong>
-id: UUID associated which each run of the script (<strong>uuid</strong>)
-start_time: Time of the start of the script's run (<strong>DateTime</strong>)
-end_time: Time of the end of the script's run (<strong>DateTime</strong>)
-linux_version: Version of the OS used for the run (<strong>String</strong>)
-toolbox_version: Version of the toolbox used for the run (<strong>String</strong>)
-script_version: Version of the script used for the run (<strong>String</strong>)</p>
<p><strong>datasets_tested</strong>
-id: UUID associated with each dataset tested, not the same as the id of <strong>testing_metadata</strong> (<strong>uuid</strong>)
-test_id: Foreign key connecting to the testing_metadata table, <strong>same as the id of testing_metadata for the run</strong> (<strong>uuid</strong>)
-dataset_id: Identifier of the dataset as used with the copernicusmarine toolbox (<strong>String</strong>)
-dataset_version: Version of the dataset (<strong>String</strong>)
-version_part: Part of the version tested (<strong>String</strong>)
-service_name: Name of the service tested (<strong>String</strong>)
-variable_name: Variable tested (<strong>String</strong>)
-command: Command launched for the first try (<strong>Text</strong>)
-last_downloadable_time: Last available time for which there is from the subset command (<strong>DateTime</strong>)
-downloadable: If the dataset was downloadable (<strong>Boolean</strong>)</p>
<p><strong>errors</strong>
-id: UUID associated with each error, not the same as the id of <strong>datasets_tested</strong> or <strong>testing_metadata</strong> (<strong>uuid</strong>)
-dataset_test_id: Foreign key connecting to the datasets_tested table, <strong>same as the id of datasets_tested for the dataset</strong> (<strong>uuid</strong>)
-command: Command associated for the error (<strong>Text</strong>)
-error_message: Message associated with the error (<strong>Text</strong>)</p>
<h2 id="consulting-tables">Consulting tables</h2>
<h3 id="simple-consultation">Simple consultation</h3>
<p>You can see the list of tables, once connected, with the following command:</p>
<pre><code class="language-bash">\dt
</code></pre>
<p>You can look a bit better at the tables with the following commands. To see the first ten rows for example:</p>
<pre><code class="language-bash">SELECT * FROM my_table LIMIT 10;
</code></pre>
<p>Or the last ten rows:</p>
<pre><code class="language-bash">SELECT * FROM my_table ORDER BY id DESC LIMIT 10;
</code></pre>
<h3 id="consultation-of-complex-schema">Consultation of complex schema</h3>
<p>If you want to consult the errors associated with a given run, you can run the following command, with <RUN_ID> replaced by the id found the in the table <strong>testing_metadata</strong>:</p>
<pre><code class="language-bash">SELECT 
    tm.id AS run_id,
    tm.start_time,
    tm.end_time,
    dt.dataset_id,
    dt.dataset_version,
    dt.version_part,
    dt.service_name,
    dt.variable_name,
    e.id AS error_id,
    e.command AS error_command,
    e.error_message
FROM testing_metadata tm
JOIN datasets_tested dt 
    ON tm.id = dt.test_id
JOIN errors e 
    ON dt.id = e.dataset_test_id
WHERE tm.id = &lt;RUN_ID&gt;
ORDER BY dt.dataset_id, e.id;
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../usage/" class="btn btn-neutral float-left" title="Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../further_development/" class="btn btn-neutral float-right" title="Further">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../usage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../further_development/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
